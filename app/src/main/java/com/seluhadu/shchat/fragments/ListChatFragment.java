package com.seluhadu.shchat.fragments;import android.content.Intent;import android.os.Bundle;import android.support.annotation.NonNull;import android.support.annotation.Nullable;import android.support.v4.app.Fragment;import android.support.v7.widget.LinearLayoutManager;import android.support.v7.widget.RecyclerView;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import com.google.firebase.auth.FirebaseAuth;import com.google.firebase.firestore.DocumentChange;import com.google.firebase.firestore.EventListener;import com.google.firebase.firestore.FirebaseFirestore;import com.google.firebase.firestore.FirebaseFirestoreException;import com.google.firebase.firestore.ListenerRegistration;import com.google.firebase.firestore.QuerySnapshot;import com.seluhadu.shchat.ChatActivity;import com.seluhadu.shchat.R;import com.seluhadu.shchat.adapters.ListUsersAdapter;import com.seluhadu.shchat.models.User;import java.util.ArrayList;import java.util.List;public class ListChatFragment extends Fragment {    private ListUsersAdapter adapter;    private FirebaseFirestore mFireStore;    private ListenerRegistration mListener;    private List<User> mListUsers;    private RecyclerView mRecyclerView;    @Override    public void onCreate(@Nullable Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        mFireStore = FirebaseFirestore.getInstance();    }    @Nullable    @Override    public View onCreateView(@NonNull final LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {        View rootView = inflater.inflate(R.layout.fragment_list_users, container, false);        mRecyclerView = rootView.findViewById(R.id.list_users_recycler_view);        mListUsers = new ArrayList<>();        adapter = new ListUsersAdapter(mListUsers, getActivity());        mRecyclerView.setAdapter(adapter);        mRecyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));        loadInformation();        adapter.setOnItemClickListener(new ListUsersAdapter.OnItemClickListener() {            @Override            public void OnItemClick(User user, int position) {                Intent intentToChat = new Intent(getActivity(), ChatActivity.class);                intentToChat.putExtra("senderId", FirebaseAuth.getInstance().getCurrentUser().getUid());                intentToChat.putExtra("receiverId", user.getUserId());                intentToChat.putExtra("fireBaseToken", user.getUserId());                Intent test = new Intent(getActivity(), ChatActivity.class);                test.putExtra("user", user);                startActivity(intentToChat);            }        });        return rootView;    }    private void loadInformation() {        mListener = mFireStore.collection("Users").addSnapshotListener(new EventListener<QuerySnapshot>() {            @Override            public void onEvent(@javax.annotation.Nullable QuerySnapshot queryDocumentSnapshots,                                @javax.annotation.Nullable FirebaseFirestoreException e) {                if (e != null) {                }                for (DocumentChange d : queryDocumentSnapshots.getDocumentChanges()) {                    User user = d.getDocument().toObject(User.class);                    mListUsers.add(user);                    adapter.notifyDataSetChanged();                }            }        });    }    @Override    public void onDestroy() {        super.onDestroy();        mListener.remove();    }}